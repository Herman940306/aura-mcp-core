# Prometheus configuration for Aura IA MCP
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # ==========================================================================
  # Blackbox Exporter - Probe HTTP endpoints for services without /metrics
  # ==========================================================================
  - job_name: 'blackbox-http'
    metrics_path: /probe
    params:
      module: [http_2xx_json]
    static_configs:
      - targets:
          - http://aura-ia-gateway:8000/healthz
          - http://aura-ia-ml:8001/health
          - http://aura-ia-ollama:11434/api/tags
    relabel_configs:
      # Pass the target URL to blackbox exporter
      - source_labels: [__address__]
        target_label: __param_target
      # Extract service name from URL for labeling
      - source_labels: [__address__]
        regex: 'http://([^:]+):.*'
        target_label: service
        replacement: '${1}'
      # Set instance label to the target URL
      - source_labels: [__param_target]
        target_label: instance
      # Point to blackbox exporter
      - target_label: __address__
        replacement: blackbox-exporter:9115

  # ==========================================================================
  # Native Prometheus metrics endpoints
  # ==========================================================================

  # Aura IA Gateway - FastAPI /metrics (MCP entrypoint)
  - job_name: 'aura-ia-gateway'
    static_configs:
      - targets: ['aura-ia-gateway:8000']
        labels:
          service: aura-ia-gateway
          component: mcp-gateway
    metrics_path: /metrics
    scrape_interval: 15s
    scrape_timeout: 10s

  # Aura IA ML Backend - FastAPI /metrics
  - job_name: 'aura-ia-ml'
    static_configs:
      - targets: ['aura-ia-ml:8001']
        labels:
          service: aura-ia-ml
          component: ml-backend
    metrics_path: /metrics
    scrape_interval: 15s
    scrape_timeout: 10s
  
  # Qdrant - has built-in Prometheus metrics
  - job_name: 'qdrant'
    static_configs:
      - targets: ['aura-ia-rag:6333']
    metrics_path: /metrics
    scrape_timeout: 10s

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Blackbox Exporter self-metrics
  - job_name: 'blackbox-exporter'
    static_configs:
      - targets: ['blackbox-exporter:9115']

  # ==========================================================================
  # Jaeger SPM (Service Performance Monitoring) Metrics
  # ==========================================================================
  - job_name: 'jaeger'
    static_configs:
      - targets: ['jaeger:14269']
    metrics_path: /metrics
    scrape_interval: 15s
